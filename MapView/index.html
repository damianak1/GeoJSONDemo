<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
        
        <!-- begin leaflet setup-->
         <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
		 <!--[if lte IE 8]>
		     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
		     <link rel="stylesheet" href="css/MarkerCluster.Default.css"/>
		     <link rel="stylesheet" href="css/MarkerCluster.ie.css"/>
		 <![endif]-->
		 <!--<link rel="stylesheet" href="css/MarkerCluster.css"></script>
		 <script src="js/leaflet.markercluster.js"></script>-->
		 <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
		 <script>
		 var map
		 var layercontrol
	 	</script>
        <!-- end leaflet setup -->
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        
        <div id="map"></div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>

        <script>
        	$(function() {
			    
			    var basemap = L.tileLayer('http://{s}.tile.cloudmade.com/73369a4171764e2e939d79791c6c573f/997/256/{z}/{x}/{y}.png', {
				    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
				    maxZoom: 18
				});
				var baseMaps = {
				    "BaseMap": basemap
				};
				map = L.map('map', {layers: [basemap]}).setView([43.6137, -116.2377], 11);
				layercontrol = L.control.layers(baseMaps).addTo(map);
				L.control.scale().addTo(map);
				getGeoData("georssurl=http://www.adaweb.net/mapping/Vandal.xml", "Vandalism");
				getGeoData("georssurl=http://www.flickr.com/services/feeds/geo/United+States/Idaho/Boise?format=rss_200");
				getGeoData("datasetname=FloodZone",  "Flood Zone");
				
				
				
			});
			function getGeoData(route, displayname){
				//"http://localhost/GeoJSON.RESTApi/api/GeoJSON?datasetname=FloodZone"
				var jqxhr = $.getJSON( "http://localhost/GeoJSON.RESTApi/api/GeoJSON?"+route, function() {
				  console.log( "success" );
				})
				  .done(function() {
				    console.log( "second success" );
				  })
				  .fail(function() {
				    console.log( "error" );
				  })
				  .always(function() {
				    console.log( "complete" );
				  });
				 
				// Perform other work here ...
				 
				// Set another completion function for the request above
				jqxhr.complete(function(data) {
				  console.log( "second complete" );
				   var ol = L.geoJson(data.responseJSON, {
					    onEachFeature: onEachFeature
					}).addTo(map);
					
					layercontrol.addOverlay(ol, displayname);
				});
			}
			function onEachFeature(feature, layer) {
			    // does this feature have a property named popupContent?
			    if (feature.properties && feature.properties.popupContent) {
			        layer.bindPopup(feature.properties.popupContent);
			    }
			}
        </script>
    </body>
</html>
